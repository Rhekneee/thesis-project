<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <title>Join Us - M.D. Buendia Construction Inc.</title>
  <link rel="stylesheet" href="/public/css/crm_style.css" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-black fixed-top">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">
      <img src="/public/image/mdb.jpg" alt="mdb" class="img-fluid logo-img" />
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
      data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
      aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ms-auto mb-2 mg-lg-0">
        <li class="nav-item">
            <a class="nav-link active" href="/crm/index">Home</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/crm/properties">Properties</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/crm/developer">Developers</a>
        <li class="nav-item">
            <a class="nav-link" href="/crm/faqs">FAQ's</a>
        </li>

        <li class="nav-item">
            <a class="nav-link" href="/crm/contact">Contact Us</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/crm/application">Join Us</a>
        </li>

        <li class="nav-item">
            <a class="nav-link" href="/">Login</a>
        </li>
    </ul>
    </div>
  </div>
</nav>

<!-- Job Application Section -->
<section class="pt-5" style="margin-top: 80px;">
  <div class="container">
    <h2 class="text-center mb-4 fw-bold">We Are Hiring!</h2>

    <div class="row">
      <!-- Job Post Card -->
      <div class="col-md-6 mb-4">
        <div class="card shadow-sm">
          <div class="card-body">
            <h5 class="card-title fw-bold">Site Engineer</h5>
            <p class="card-text">We are looking for a qualified Site Engineer with experience in project supervision and field management. Must have knowledge in AutoCAD and civil works documentation.</p>
            <button class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#applyModal">Apply Now</button>
          </div>
        </div>
      </div>

      <!-- Another Job Post -->
      <div class="col-md-6 mb-4">
        <div class="card shadow-sm">
          <div class="card-body">
            <h5 class="card-title fw-bold">Architect</h5>
            <p class="card-text">We are seeking a creative Architect to design residential homes and oversee project design phases. Proficiency in architectural software is required.</p>
            <button class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#applyModal">Apply Now</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Modal -->
<<!-- Modal for Resume Upload -->
<div class="modal fade" id="applyModal" tabindex="-1" aria-labelledby="applyModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content border-0 shadow">
        <div class="modal-header bg-dark text-white">
          <h5 class="modal-title" id="applyModalLabel">Submit Your Application</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form id="applicationForm" enctype="multipart/form-data">
            <div class="modal-body">
                <!-- First Name -->
                <div class="mb-3">
                    <label for="firstname" class="form-label">First Name</label>
                    <input type="text" class="form-control" id="firstname" required />
                </div>

                <!-- Last Name -->
                <div class="mb-3">
                    <label for="lastname" class="form-label">Last Name</label>
                    <input type="text" class="form-control" id="lastname" required />
                </div>

                <!-- Middle Initial -->
                <div class="mb-3">
                    <label for="middleinitial" class="form-label">Middle Initial</label>
                    <input type="text" class="form-control" id="middleinitial" required />
                </div>

                <!-- Age -->
                <div class="mb-3">
                    <label for="age" class="form-label">Age</label>
                    <input type="number" class="form-control" id="age" min="18" required />
                </div>

                <!-- Birthdate -->
                <div class="mb-3">
                    <label for="birthdate" class="form-label">Birthdate</label>
                    <input type="date" class="form-control" id="birthdate" required />
                </div>

                <!-- Contact Number -->
                <div class="mb-3">
                    <label for="phone" class="form-label">Contact Number</label>
                    <input type="text" class="form-control" id="phone" pattern="^\+?\d{1,4}?[\d\s\-\(\)]{7,15}$" required />
                    <small class="form-text text-muted">Enter a valid contact number.</small>
                </div>

                <!-- Email Address -->
                <div class="mb-3">
                    <label for="email" class="form-label">Email Address</label>
                    <input type="email" class="form-control" id="email" required />
                    <small class="form-text text-muted">We'll never share your email.</small>
                </div>

                <!-- Resume Upload -->
                <div class="mb-3">
                    <label for="resume" class="form-label">Upload Resume (PDF only)</label>
                    <input class="form-control" type="file" id="resume" accept="application/pdf" required />
                    <small class="form-text text-muted">Only PDF files are accepted.</small>
                    <p id="fileError" style="color: red; display: none;">Please upload a valid PDF file.</p>
                </div>

                <!-- PDF Preview -->
                <div id="pdfPreview" style="display: none;">
                    <h5>Preview Your Resume:</h5>
                    <canvas id="pdfViewer"></canvas>
                </div>
            </div>

            <!-- Submit Button -->
            <div class="modal-footer">
                <button type="submit" class="btn btn-dark">Submit Application</button>
            </div>
        </form>
      </div>
    </div>
  </div>
  
  <!-- Footer -->
  <footer class="bg-dark text-light pt-4 mt-5">
    <div class="container">
      <div class="row">
        <div class="col-lg-5">
          <h5>About Us</h5>
          <p>M.D. Buendia Construction Inc. specializes in high-quality residential construction...</p>
        </div>
        <div class="col-lg-4">
          <h5>Contacts</h5>
          <p><i class="fa fa-map-marker-alt"></i> Naic, Cavite</p>
          <p><i class="fa fa-phone"></i> (92) 0325 12344567</p>
          <p><i class="fa fa-envelope"></i> mdb_engineering@yahoo.com</p>
        </div>
        <div class="col-lg-3">
          <h5>Stay Connected</h5>
          <ul class="list-unstyled">
            <li><a href="#"><i class="fab fa-facebook"></i> Facebook</a></li>
            <li><a href="#"><i class="fab fa-linkedin"></i> LinkedIn</a></li>
            <li><a href="#"><i class="fab fa-instagram"></i> Instagram</a></li>
            <li><a href="#"><i class="fab fa-twitter"></i> Twitter</a></li>
          </ul>
        </div>
      </div>
      <hr />
      <p class="text-center mb-0">Â© 2025 <a href="#">M.D. BUENDIA</a>. All Rights Reserved.</p>
    </div>
  </footer>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.9.359/pdf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  
  <script>
    // Handle form submission and PDF rendering
    document.getElementById("applicationForm").addEventListener("submit", async function(event) {
    event.preventDefault();

    // Get the resume file
    const resumeFile = document.getElementById("resume").files[0];

    // Check if the file is a PDF
    if (resumeFile && resumeFile.type !== "application/pdf") {
        document.getElementById("fileError").style.display = "block";
        return; // Stop submission if file is not PDF
    } else {
        document.getElementById("fileError").style.display = "none"; // Hide error if PDF is valid
    }

    // Prepare form data
    let formData = new FormData();
    formData.append("firstname", document.getElementById("firstname").value);
    formData.append("lastname", document.getElementById("lastname").value);
    formData.append("middleinitial", document.getElementById("middleinitial").value);
    formData.append("age", document.getElementById("age").value);
    formData.append("birthdate", document.getElementById("birthdate").value);
    formData.append("phone", document.getElementById("phone").value);
    formData.append("email", document.getElementById("email").value);
    formData.append("resume", resumeFile); // Ensure you are appending the file

    try {
        // Show loading spinner (optional, can be added to improve UX)
        let response = await fetch("http://localhost:4000/crm/upload", {
            method: "POST",
            body: formData
        });

        let result = await response.json();

        if (response.ok) {
            alert(result.message); // Success message
            $('#applyModal').modal('hide'); // Hide the modal after successful submission
            document.getElementById("applicationForm").reset(); // Reset the form fields
        } else {
            alert(result.error); // Error message from backend
        }
    } catch (error) {
        alert("Error uploading resume. Please try again.");
        console.error("Error:", error);
    }
});

  
    // Render PDF preview on file selection
    document.getElementById('resume').addEventListener('change', function (event) {
    const resumeFile = event.target.files[0];
    if (resumeFile && resumeFile.type === 'application/pdf') {
        const reader = new FileReader();
        reader.onload = async function (e) {
            const pdfData = e.target.result;
            const loadingTask = pdfjsLib.getDocument({ data: pdfData });

            try {
                const pdfDocument = await loadingTask.promise;
                const page = await pdfDocument.getPage(1);  // Get the first page
                const viewport = page.getViewport({ scale: 1 });
                const canvas = document.getElementById('pdfViewer');
                const context = canvas.getContext('2d');
                canvas.width = viewport.width;
                canvas.height = viewport.height;

                // Use the await keyword to ensure page.render() completes
                await page.render({ canvasContext: context, viewport: viewport });

                document.getElementById('pdfPreview').style.display = 'block'; // Show preview
            } catch (error) {
                console.error('Error rendering PDF:', error);
            }
        };
        reader.readAsArrayBuffer(resumeFile);
    }
});


  </script>
  
</body>
</html>
