<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Request Materials</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
<<<<<<< HEAD
    <script src="/js/side_top.js"></script>
    <link rel="stylesheet" href="/css/side_top.css">
    <style>
=======
    <link rel="stylesheet" href="/css/side_top.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background-color: #f8f9fa;
        }
        
        #wrapper {
            display: flex;
            min-height: 100vh;
            position: relative;
        }

>>>>>>> development
        #content {
            flex: 1;
            margin-left: 290px; /* Increased from 220px to move content more to the right */
            padding: 20px;
            padding-top: 10px; /* Add space for topbar */
            transition: margin-left 0.3s;
            background-color: #f8f9fa;
            min-height: 100vh;
        }

        /* When sidebar is collapsed */
        #wrapper.sidebar-collapsed #content {
            margin-left: 0;
        }

        .request-form {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        /* Update other styles to use white background for better contrast */
        .materials-list {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        .recent-requests {
            background: white;
            border-radius: 10px;
            padding: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.05);
            margin-top: 2px;    
        }

        .btn-group {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 0 10px rgba(0,0,0,0.05);
        }

        /* Ensure modals appear above everything */
        .modal {
            z-index: 1050;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            #content {
                margin-left: 0;
                padding-top: 70px;
            }
        }

        .material-list {
            margin-top: 20px;
        }
        .material-item {
            background: white;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .form-label {
            font-weight: 500;
        }
        .btn-add-material {
            margin-top: 10px;
        }
        .table th {
            background-color: #f8f9fa;
        }
        .materials-list h5 {
            color: #495057;
            margin-bottom: 15px;
        }
        .notes-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }
        .notes-section .form-label {
            color: #495057;
            font-weight: 500;
        }
        .recent-requests h4 {
            color: #495057;
            margin-bottom: 20px;
        }
        .table {
            background: white;
            border-radius: 5px;
        }
        .table thead {
            background: #f8f9fa;
        }
    </style>
</head>
<body>
    <div id="wrapper">
                <!-- Topbar -->
                <div class="topbar">
                    <div class="topbar-left">
                        <div class="menu-toggle" onclick="toggleSidebar()">
                            <i class="fas fa-bars"></i>
                        </div>
                    </div>
                    <div class="topbar-right">
                        <div class="notification-icon" onclick="toggleNotifications()">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge"></span>
                        </div>
                        <div class="profile-section" onclick="window.location.href='/hr/hr_profile'">
                            <div class="profile-info">
                                <div class="profile-name"></div>
                                <div class="profile-position"></div>
                            </div>
                            <div class="profile-picture-container" style="width: 40px; height: 40px; margin: 0;">
                                <img src="/hr/default-profile-picture" alt="Profile" class="profile-picture" id="topbarProfilePicture">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Notification Dropdown -->
                    <div class="notification-dropdown" id="notificationDropdown">
                        <div class="notification-header">
                            <span>Notifications</span>
                            <button class="mark-all-read" onclick="markAllAsRead()">Mark all as read</button>
                        </div>
                        <div class="notification-item">
                            <div class="notification-title">New Leave Request</div>
                            <div class="notification-time">5 minutes ago</div>
                        </div>
                        <div class="notification-item">
                            <div class="notification-title">Payroll Processed</div>
                            <div class="notification-time">1 hour ago</div>
                        </div>
                        <div class="notification-item">
                                <span class="profile-name">John Doe</span>
                                <span class="profile-position">HR Manager</span>
                            </div>
                        </div>
                        
                        <!-- Notification Dropdown -->
                        <div class="notification-dropdown" id="notificationDropdown">
                            <div class="notification-header">
                                <span>Notifications</span>
                                <button class="mark-all-read" onclick="markAllAsRead()">Mark all as read</button>
                            </div>
                            <div class="notification-item">
                                <div class="notification-title">New Leave Request</div>
                                <div class="notification-time">5 minutes ago</div>
                            </div>
                            <div class="notification-item">
                                <div class="notification-title">Payroll Processed</div>
                                <div class="notification-time">1 hour ago</div>
                            </div>
                            <div class="notification-item">
                                <div class="notification-title">New Employee Added</div>
                                <div class="notification-time">2 hours ago</div>
                            </div>
                        </div>
                    </div>
                </div>
<<<<<<< HEAD
                <!-- Sidebar -->
                <div class="sidebar" id="sidebar">
                    <div class="sidebar-header">
                        <img src="/image/mdb-removebg-preview.png" alt="MDB Logo">
                        <span class="company-title">MDB Construction</span>
                    </div>
                    <ul class="list-unstyled">
                        <li class="nav-item active">
                            <a class="nav-item" href="/manufacturing/manufacturing_dashboard"><i class="fas fa-tachometer-alt"></i> <span>Dashboard</span></a>
                        </li>
                        <li class="nav-item">
                            <a href="#" data-bs-toggle="collapse" data-bs-target="#Attendance" aria-expanded="false">
                                <i class="fas fa-calendar-check"></i> <span>Attendance</span> 
                            </a>
                            <ul class="collapse" id="Attendance">
                                <li class="nav-item"><a href="/manufacturing/manufacturing_daily_attendance"><i class="fas fa-calendar-check"></i> <span>Daily Attendance</span></a></li>
                                <li class="nav-item"><a href="/manufacturing/manufacturing_leave_request"><i class="fas fa-file-invoice"></i> <span>Request Leave</span></a></li>
                                <li class="nav-item"><a href="/manufacturing/manufacturing_halfday_request"><i class="fas fa-business-time"></i> <span>Halfday Request</span></a></li>
                                <li class="nav-item"><a href="/manufacturing/manufacturing_overtime"><i class="fas fa-history"></i> <span>Overtime</span></a></li>
                            </ul>
                        </li>
                        <li class="nav-item">
                            <a href="#" data-bs-toggle="collapse" data-bs-target="#Projects" aria-expanded="false">
                                <i class="fas fa-project-diagram"></i> <span>Projects</span>    
                            </a>
                            <ul class="collapse" id="Projects">
                                <li class="nav-item"><a href="/manufacturing/manufacturing_projects"><i class="fas fa-code-branch"></i> <span>Developer Projects</span></a></li>
                                <li class="nav-item"><a href="/manufacturing/manufacturing_approved_project"><i class="fas fa-check-circle"></i> <span>Approved Projects</span></a></li>
                                <li class="nav-item"><a href="/manufacturing/manufacturing_progress"><i class="fas fa-tasks"></i> <span>Project Progress</span></a></li>
                            </ul>
                        </li>
                        <li class="nav-item">
                            <a href="/manufacturing/manufacturing_request_materials"><i class="fas fa-box"></i> <span>Request Materials</span></a>
                        </li>
                        <li class="nav-item">
                            <a href="/manufacturing/manufacturing_ratings"><i class="fas fa-star"></i> <span>Ratings & Feedback</span></a>
                        </li>
                        <li class="nav-item">
                            <a href="/manufacturing/manufacturing_foremen"><i class="fas fa-hard-hat"></i> <span>Foremen List</span></a>
                        </li>
                        <li class="logout nav-item"><a href="/login"><i class="fas fa-sign-out-alt"></i> <span>Logout</span></a></li>
                    </ul>
                </div>
        
        <!-- Main content area -->
        <div id="content">


=======
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <img src="/image/mdb-removebg-preview.png" alt="MDB Logo">
                <span class="company-title">MDB Construction</span>
            </div>
            <ul class="list-unstyled">
                <li class="nav-item">
                    <a class="nav-item" href="/manufacturing/manufacturing_dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
                </li>
                <li class="nav-item">
                    <a href="#" data-bs-toggle="collapse" data-bs-target="#Attendance" aria-expanded="false">
                        <i class="fas fa-calendar-check"></i> Attendance 
                    </a>
                    <ul class="collapse" id="Attendance">
                        <li class="nav-item"><a href="/manufacturing/manufacturing_daily_attendance"><i class="fas fa-calendar-check"></i> Daily Attendance</a></li>
                        <li class="nav-item"><a href="/manufacturing/manufacturing_leave_request"><i class="fas fa-file-invoice"></i> Request Leave</a></li>
                        <li class="nav-item"><a href="/manufacturing/manufacturing_overtime"><i class="fas fa-business-time"></i> Overtime</a></li>
                    </ul>
                </li>
                <li class="nav-item">
                    <a href="#" data-bs-toggle="collapse" data-bs-target="#Projects" aria-expanded="false">
                        <i class="fas fa-project-diagram"></i> Projects</i>
                    </a>
                    <ul class="collapse" id="Projects">
                        <li class="nav-item"><a href="/manufacturing/manufacturing_projects"><i class="fas fa-code-branch"></i> Developer Projects</a></li>
                        <li class="nav-item active"><a href="/manufacturing/manufacturing_approved_project"><i class="fas fa-check-circle"></i> Approved Projects</a></li>
                        <li class="nav-item"><a href="/manufacturing/manufacturing_progress"><i class="fas fa-tasks"></i> Project Progress</a></li>
                    </ul>
                </li>
                <li class="nav-item">
                    <a href="/manufacturing/manufacturing_request_materials"><i class="fas fa-box"></i> Request Materials</a>
                </li>
                <li class="nav-item">
                    <a href="/manufacturing/manufacturing_ratings"><i class="fas fa-star"></i> Ratings & Feedback</a>
                </li>
                <li class="nav-item">
                    <a href="/manufacturing/manufacturing_foremen"><i class="fas fa-hard-hat"></i> Foremen List</a>
                </li>
                <li class="logout nav-item"><a href="/login"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
            </ul>
        </div>

        <!-- Main content area -->
        <div id="content">
           
>>>>>>> development
            <h2>Request Materials</h2>

            <!-- Request Form -->
            <div class="request-form">
                <form id="materialRequestForm">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="projectSelect" class="form-label">Select Project</label>
                            <select class="form-select" id="projectSelect" required>
                                <option value="">Choose Project...</option>
                                <option value="1">Project A</option>
                                <option value="2">Project B</option>
                                <option value="3">Project C</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="requestDate" class="form-label">Request Date</label>
                            <input type="date" class="form-control" id="requestDate" required>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label for="materialType" class="form-label">Material Type</label>
                            <select class="form-select" id="materialType" required>
                                <option value="">Select Material Type...</option>
                                <option value="cement">Cement</option>
                                <option value="steel">Steel</option>
                                <option value="wood">Wood</option>
                                <option value="bricks">Bricks</option>
                                <option value="sand">Sand</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="quantity" class="form-label">Quantity</label>
                            <input type="number" class="form-control" id="quantity" min="1" required>
                        </div>
                        <div class="col-md-3">
                            <label for="unit" class="form-label">Unit</label>
                            <select class="form-select" id="unit" required>
                                <option value="">Select Unit...</option>
                                <option value="kg">Kilograms (kg)</option>
                                <option value="bags">Bags</option>
                                <option value="pieces">Pieces</option>
                                <option value="cubic">Cubic Meters</option>
                            </select>
                        </div>
                        <div class="col-md-2 d-flex align-items-end">
                            <button type="button" class="btn btn-success w-100" onclick="addMaterial()">
                                <i class="fas fa-plus"></i> Add
                            </button>
                        </div>
                    </div>

                    <!-- Materials List, Notes, and Submit Section -->
                    <div class="materials-list">
                        <h5>Materials to Request</h5>
                        <div class="table-responsive mb-3">
                            <table class="table table-bordered">
                                <thead class="table-light">
                                    <tr>
                                        <th>Material Type</th>
                                        <th>Quantity</th>
                                        <th>Unit</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="materialsList">
                                    <!-- Materials will be added here dynamically -->
                                </tbody>
                            </table>
                        </div>

                        <div class="row mb-3">
                            <div class="col-12">
                                <label for="notes" class="form-label">Additional Notes</label>
                                <textarea class="form-control" id="notes" rows="3" placeholder="Enter any additional notes or specifications..."></textarea>
                            </div>
                        </div>

                        <div class="d-flex justify-content-end">
                            <button type="button" class="btn btn-primary" id="submitRequest" onclick="showSubmitConfirmation()" disabled>
                                <i class="fas fa-paper-plane"></i> Submit Request
                            </button>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Recent Requests Table -->
            <div class="recent-requests">
                <h4>Recent Material Requests</h4>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Request ID</th>
                            <th>Project</th>
                            <th>Request Date</th>
                            <th>Approved Date</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="recentRequests">
                        <!-- Requests will be added here dynamically -->
                    </tbody>
                </table>
            </div>

            <!-- Submit Confirmation Modal -->
            <div class="modal fade" id="submitConfirmationModal" tabindex="-1" aria-labelledby="submitConfirmationModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="submitConfirmationModalLabel">Confirm Material Request</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <!-- Placeholder for the error and success messages -->
                            <div id="formMessages" style="display: none;">
                                <div id="errorMessage" class="alert alert-danger" style="display: none;"></div>
                                <div id="successMessage" class="alert alert-success" style="display: none;"></div>
                            </div>
                            <!-- Confirmation Content -->
                            <div id="confirmationContent">
                                <p>Please confirm the following details:</p>
                                <div class="mb-3">
                                    <strong>Project:</strong> <span id="confirmProject"></span>
                                </div>
                                <div class="mb-3">
                                    <strong>Request Date:</strong> <span id="confirmRequestDate"></span>
                                </div>
                                <div class="mb-3">
                                    <strong>Materials:</strong>
                                    <ul id="confirmMaterialsList" class="list-unstyled">
                                    </ul>
                                </div>
                                <div class="mb-3">
                                    <strong>Notes:</strong> <span id="confirmNotes"></span>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer" id="modalFooter">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary" onclick="submitRequest()">Confirm Request</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Request Details Modal -->
            <div class="modal fade" id="requestDetailsModal" tabindex="-1" aria-labelledby="requestDetailsModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="requestDetailsModalLabel">Request Details</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <p><strong>Request ID:</strong> <span id="modalRequestId"></span></p>
                                    <p><strong>Project:</strong> <span id="modalProject"></span></p>
                                    <p><strong>Request Date:</strong> <span id="modalRequestDate"></span></p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>Status:</strong> <span id="modalStatus"></span></p>
                                    <p><strong>Approved Date:</strong> <span id="modalApprovedDate"></span></p>
                                    <p><strong>Notes:</strong> <span id="modalNotes"></span></p>
                                </div>
                            </div>
                            <h6>Requested Materials</h6>
                            <div class="table-responsive">
                                <table class="table table-bordered">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Material Type</th>
                                            <th>Quantity</th>
                                            <th>Unit</th>
                                        </tr>
                                    </thead>
                                    <tbody id="modalMaterialsList">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-danger" id="cancelRequestBtn" style="display: none;" onclick="cancelRequest()">Cancel Request</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Edit Material Modal -->
            <div class="modal fade" id="editMaterialModal" tabindex="-1" aria-labelledby="editMaterialModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="editMaterialModalLabel">Edit Material</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form id="editMaterialForm">
                                <div class="mb-3">
                                    <label for="editMaterialType" class="form-label">Material Type</label>
                                    <select class="form-select" id="editMaterialType" required>
                                        <option value="">Select Material Type...</option>
                                        <option value="cement">Cement</option>
                                        <option value="steel">Steel</option>
                                        <option value="wood">Wood</option>
                                        <option value="bricks">Bricks</option>
                                        <option value="sand">Sand</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="editQuantity" class="form-label">Quantity</label>
                                    <input type="number" class="form-control" id="editQuantity" min="1" required>
                                </div>
                                <div class="mb-3">
                                    <label for="editUnit" class="form-label">Unit</label>
                                    <select class="form-select" id="editUnit" required>
                                        <option value="">Select Unit...</option>
                                        <option value="kg">Kilograms (kg)</option>
                                        <option value="bags">Bags</option>
                                        <option value="pieces">Pieces</option>
                                        <option value="cubic">Cubic Meters</option>
                                    </select>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary" onclick="saveMaterialEdit()">Save Changes</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS and jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Update sidebar functionality
        document.addEventListener('DOMContentLoaded', function() {
            const wrapper = document.getElementById('wrapper');
            const sidebar = document.getElementById('sidebar');
            const content = document.getElementById('content');
            const menuToggle = document.querySelector('.menu-toggle');

            menuToggle.addEventListener('click', function() {
                wrapper.classList.toggle('sidebar-collapsed');
            });

            // Handle submenu toggles
            document.querySelectorAll('[data-bs-toggle="collapse"]').forEach(element => {
                element.addEventListener('click', function(e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('data-bs-target'));
                    target.classList.toggle('show');
                });
            });

            // Set default date to today
            document.getElementById('requestDate').valueAsDate = new Date();

            // Initialize the materials list
            updateMaterialsList();
            updateSubmitButton();
        });

        // Global variables
        let materials = [];
        let editingIndex = -1;
        let requests = {};

        // Add material to the list
        function addMaterial() {
            const materialType = document.getElementById('materialType');
            const quantity = document.getElementById('quantity');
            const unit = document.getElementById('unit');

            // Validate inputs
            if (!materialType.value || !quantity.value || !unit.value) {
                alert('Please fill in all material details');
                return;
            }

            const material = {
                type: materialType.options[materialType.selectedIndex].text,
                typeValue: materialType.value,
                quantity: quantity.value,
                unit: unit.options[unit.selectedIndex].text,
                unitValue: unit.value
            };

            if (editingIndex >= 0) {
                // Update existing material
                materials[editingIndex] = material;
                editingIndex = -1;
            } else {
                // Add new material
                materials.push(material);
            }

            // Clear form fields after adding/updating
            resetMaterialForm();
            
            updateMaterialsList();
            updateSubmitButton();
        }

        // Update the materials list in the table
        function updateMaterialsList() {
            const tbody = document.getElementById('materialsList');
            tbody.innerHTML = '';

            materials.forEach((material, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${material.type}</td>
                    <td>${material.quantity}</td>
                    <td>${material.unit}</td>
                    <td>
                        <button type="button" class="btn btn-sm btn-info me-1" onclick="openEditModal(${index})" title="Edit Material">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button type="button" class="btn btn-sm btn-danger" onclick="removeMaterial(${index})" title="Remove Material">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Open edit modal
        function openEditModal(index) {
            const material = materials[index];
            document.getElementById('editMaterialType').value = material.typeValue;
            document.getElementById('editQuantity').value = material.quantity;
            document.getElementById('editUnit').value = material.unitValue;
            editingIndex = index;

            const editModal = new bootstrap.Modal(document.getElementById('editMaterialModal'));
            editModal.show();
        }

        // Save material edit
        function saveMaterialEdit() {
            const materialType = document.getElementById('editMaterialType');
            const quantity = document.getElementById('editQuantity');
            const unit = document.getElementById('editUnit');

            // Validate inputs
            if (!materialType.value || !quantity.value || !unit.value) {
                alert('Please fill in all material details');
                return;
            }

            // Show confirmation dialog
            if (confirm('Are you sure you want to save these changes?')) {
                const material = {
                    type: materialType.options[materialType.selectedIndex].text,
                    typeValue: materialType.value,
                    quantity: quantity.value,
                    unit: unit.options[unit.selectedIndex].text,
                    unitValue: unit.value
                };

                // Update the material
                materials[editingIndex] = material;
                editingIndex = -1;

                // Update the list and close modal
                updateMaterialsList();
                const editModal = bootstrap.Modal.getInstance(document.getElementById('editMaterialModal'));
                editModal.hide();

                // Show success message
                alert('Material updated successfully!');
            }
        }

        // Remove material
        function removeMaterial(index) {
            if (confirm('Are you sure you want to remove this material?')) {
                materials.splice(index, 1);
                updateMaterialsList();
                updateSubmitButton();
            }
        }

        // Reset material form
        function resetMaterialForm() {
            document.getElementById('materialType').value = '';
            document.getElementById('quantity').value = '';
            document.getElementById('unit').value = '';
            editingIndex = -1;
        }

        // Update submit button state
        function updateSubmitButton() {
            const submitButton = document.getElementById('submitRequest');
            submitButton.disabled = materials.length === 0;
        }

        // Reset entire form
        function resetForm() {
            document.getElementById('materialRequestForm').reset();
            document.getElementById('requestDate').valueAsDate = new Date();
            materials = [];
            updateMaterialsList();
            updateSubmitButton();
        }

        // Show submit confirmation modal
        function showSubmitConfirmation() {
            const project = document.getElementById('projectSelect');
            const projectName = project.options[project.selectedIndex].text;
            const requestDate = document.getElementById('requestDate').value;
            const notes = document.getElementById('notes').value;

            // Update confirmation modal content
            document.getElementById('confirmProject').textContent = projectName;
            document.getElementById('confirmRequestDate').textContent = requestDate;
            document.getElementById('confirmNotes').textContent = notes || 'None';

            // Update materials list
            const materialsList = document.getElementById('confirmMaterialsList');
            materialsList.innerHTML = '';
            materials.forEach(material => {
                const li = document.createElement('li');
                li.textContent = `${material.type} - ${material.quantity} ${material.unit}`;
                materialsList.appendChild(li);
            });

            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('submitConfirmationModal'));
            modal.show();
        }

        // Submit request
        function submitRequest() {
            const project = document.getElementById('projectSelect');
            const projectName = project.options[project.selectedIndex].text;
            const requestDate = document.getElementById('requestDate').value;
            const notes = document.getElementById('notes').value;

            // Hide any previous messages
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('formMessages').style.display = 'block';

            // Validate required fields
            if (!project.value || !requestDate || materials.length === 0) {
                document.getElementById('errorMessage').innerHTML = 'Please fill in all required fields and add at least one material!';
                document.getElementById('errorMessage').style.display = 'block';
                
                // Hide error message after 2 seconds
                setTimeout(() => {
                    document.getElementById('errorMessage').style.display = 'none';
                }, 2000);
                return;
            }

            try {
                // Generate a new request ID
                const requestId = 'REQ' + String(Object.keys(requests).length + 1).padStart(3, '0');

                // Create the new request object
                const newRequest = {
                    id: requestId,
                    project: projectName,
                    requestDate: requestDate,
                    approvedDate: null,
                    status: 'Pending',
                    notes: notes || 'None',
                    materials: [...materials]
                };

                // Add to requests object
                requests[requestId] = newRequest;

                // Add to the recent requests table
                const tbody = document.getElementById('recentRequests');
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${requestId}</td>
                    <td>${projectName}</td>
                    <td>${requestDate}</td>
                    <td>-</td>
                    <td><span class="badge bg-warning">Pending</span></td>
                    <td>
                        <button class="btn btn-sm btn-primary me-1" onclick="viewRequestDetails('${requestId}')" title="View Request Details">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                `;
                tbody.insertBefore(row, tbody.firstChild);

                // Reset form fields
                resetFormFields();

                // Hide confirmation content and show success message
                document.getElementById('confirmationContent').style.display = 'none';
                document.getElementById('modalFooter').style.display = 'none';
                document.getElementById('successMessage').innerHTML = 'Material request submitted successfully!';
                document.getElementById('successMessage').style.display = 'block';

                // Close modal after 2 seconds
                setTimeout(() => {
                    const modal = bootstrap.Modal.getInstance(document.getElementById('submitConfirmationModal'));
                    modal.hide();
                    
                    // Reset modal content for next use
                    setTimeout(() => {
                        document.getElementById('confirmationContent').style.display = 'block';
                        document.getElementById('modalFooter').style.display = 'block';
                        document.getElementById('formMessages').style.display = 'none';
                        document.getElementById('successMessage').style.display = 'none';
                    }, 500);
                }, 2000);

            } catch (error) {
                // Show error message if something goes wrong
                document.getElementById('errorMessage').innerHTML = 'An error occurred while submitting the request. Please try again.';
                document.getElementById('errorMessage').style.display = 'block';
                
                // Hide error message after 2 seconds
                setTimeout(() => {
                    document.getElementById('errorMessage').style.display = 'none';
                }, 2000);
            }
        }

        // Reset form fields
        function resetFormFields() {
            document.getElementById('projectSelect').value = '';
            document.getElementById('requestDate').valueAsDate = new Date();
            document.getElementById('notes').value = '';
            materials = [];
            updateMaterialsList();
            updateSubmitButton();
        }

        // View request details
        function viewRequestDetails(requestId) {
            const request = requests[requestId];
            if (!request) return;

            // Update modal content
            document.getElementById('modalRequestId').textContent = request.id;
            document.getElementById('modalProject').textContent = request.project;
            document.getElementById('modalRequestDate').textContent = request.requestDate;
            document.getElementById('modalApprovedDate').textContent = request.approvedDate || '-';
            document.getElementById('modalNotes').textContent = request.notes || 'None';
            
            // Update status with appropriate badge
            let statusBadge;
            switch(request.status) {
                case 'Pending':
                    statusBadge = '<span class="badge bg-warning">Pending</span>';
                    break;
                case 'Approved':
                    statusBadge = '<span class="badge bg-success">Approved</span>';
                    break;
                case 'Cancelled':
                    statusBadge = '<span class="badge bg-danger">Cancelled</span>';
                    break;
                default:
                    statusBadge = '<span class="badge bg-warning">Pending</span>';
            }
            document.getElementById('modalStatus').innerHTML = statusBadge;

            // Update materials list
            const materialsList = document.getElementById('modalMaterialsList');
            materialsList.innerHTML = '';
            request.materials.forEach(material => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${material.type}</td>
                    <td>${material.quantity}</td>
                    <td>${material.unit}</td>
                `;
                materialsList.appendChild(row);
            });

            // Show/hide cancel button based on status
            const cancelBtn = document.getElementById('cancelRequestBtn');
            cancelBtn.style.display = request.status === 'Pending' ? 'block' : 'none';

            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('requestDetailsModal'));
            modal.show();
        }

        // Cancel request
        function cancelRequest() {
            if (confirm('Are you sure you want to cancel this request?')) {
                const requestId = document.getElementById('modalRequestId').textContent;
                const request = requests[requestId];
                
                if (request) {
                    // Update request status
                    request.status = 'Cancelled';
                    
                    // Update the status in the table
                    const rows = document.getElementById('recentRequests').getElementsByTagName('tr');
                    for (let row of rows) {
                        if (row.cells[0].textContent === requestId) {
                            row.cells[4].innerHTML = '<span class="badge bg-danger">Cancelled</span>';
                            break;
                        }
                    }

                    // Update the status in the modal
                    document.getElementById('modalStatus').innerHTML = '<span class="badge bg-danger">Cancelled</span>';
                    
                    // Hide the cancel button
                    document.getElementById('cancelRequestBtn').style.display = 'none';
                }

                const modal = bootstrap.Modal.getInstance(document.getElementById('requestDetailsModal'));
                modal.hide();
                alert('Request cancelled successfully');
            }
        }
    </script>
</body>
</html>
